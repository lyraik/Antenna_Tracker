<!DOCTYPE html>

<html>

<head>
    <title>Antennatracker</title>
    <link rel="stylesheet" , type="text/css" , href="style.css">
</head>

<body style="background-color: #272727" onload="setProgressBar(160)">
    <script>
        setInterval(() => {

            var long = get('position/tracked/longitude');
            var latt = get('position/tracked/lattitude');
            var alt = get('position/tracked/altitude');

            var angleHorizontal = get('/api/direction/horizontal');
            var angleVertical = get('/api/direction/vertical');

            document.getElementById("long").innerHTML = long.value;
            document.getElementById("lat").innerHTML = latt.value;
            document.getElementById("alt").innerHTML = alt.value;

            var rotateangle = "rotate(".concat(angleHorizontal).concat("deg)");
            document.getElementById("compNeedle").style.transform = rotateangle;

        }, 200);

        function manualControl() {

            window.alert("you can now control the Antenna Tracker with the arrow keys");

            document.addEventListener('keydown', function (event) {

                if (event.keyCode == 38) {
                    //keyup
                    post("api/direction/vertical", JSON.stringify({ writableNumber: '10' }));
                }
                else if (event.keyCode == 37) {
                    //keyleft
                    post("api/direction/horizontal", JSON.stringify({ writableNumber: '10' }));
                }
                else if (event.keyCode == 39) {
                    post("api/direction/horizontal", JSON.stringify({ writableNumber: '-10' }));
                    //keyright
                }
                else if (event.keyCode == 40) {
                    post("api/direction/vertical", JSON.stringify({ writableNumber: '-10' }));
                    //keydown
                }
            });
        }

        function createEntry() {
            var table = document.getElementById("output");

            var entry = document.createElement("tr");
            var row = document.createElement("th");
            row.setAttribute('style', "position: relative; top: 170px ; left: 0px; width: 500px");
            var val = document.createElement("p");
            var inputtag = document.createElement("input");
            inputtag.setAttribute('type', "text");
            inputtag.setAttribute('style', "border: none; color: white; background-color: rgb(36, 35, 35)");
            val.appendChild("inputtag");
            val.innerHTML = "value: ";
            row.appendChild(val);
            entry.appendChild(row);
            table.appendChild(entry);
        }

        function get(val) {
            var location = "/api/".concat(val);
            var xr = new XMLHttpRequest();
            xr.open('GET', location, true);
            xr.setRequestHeader("api-version", 1.1);
            xr.send();
            var response;
            xr.addEventListener("readystatechange", function () {

                if (xr.readyState == 4 && xr.status == 200) {
                    console.log("got response");

                    response = Json.parse(xr.responseText);

                    if (val == "scan") {

                        for (var i = 0; i < response.count; i++) {
                            var opt = document.createElement('option').setAttribute('value', response.i);
                            document.getElementById("devices").appendChild(opt);
                        }
                    }
                }
                else if (xr.readyState == 4 && xr.status == 404) {
                    console.log("response failed");
                }
            }, false);
            return response;
        }

        function post(location, obi) {
            var location = "/api/".concat(location);
            var xr = new XMLHttpRequest();
            xr.open('POST', location, true);
            xr.setRequestHeader("api-version", 1.1);
            xr.send(JSON.parse(obi));
            var response;
            xr.addEventListener("readystatechange", function () {

                if (xr.readyState == 4 && xr.status == 200) {
                    console.log("got response");

                    response = Json.parse(xr.responseText);
                }
                else if (xr.readyState == 4 && xr.status == 404) {
                    console.log("response failed");
                }
            }, false);
        }

        function setProgressBar(angle) {
            var topval = String(478 - angle);
            document.getElementById("progressbar").style.height = String(50 + angle).concat("px");
            document.getElementById("progressbar").style.top = topval.concat("px");
        }

        function selectdevice() {
            var sel = document.getElementById("devices");
            var selval = sel.options[sel.selectedIndex].text;
            post("bluetooth/set",selval);
        }
    </script>
    <H3
        style="width: 1203px; position: absolute; top: 0cm; background-color: #555555;background-size: 50px; line-height: 50px; color:white; align-content: center">
        Antenna Tracker
    </H3>


    <input id="req" type="button" style="align-self: center" onclick="get('scan')" value="Get Bluetooth devices">

    <select id="devices" style="color: white" onchange="selectdevice()">
        <option>please select a device</option>
    </select>


    <input id="manual" type="button" style="align-self: center" onclick="manualControl()"
        value="activate manual control">

    <!--Menu-->
    <ul id="menu">
        <li><a onclick="get('wifi')">wifi</a></li>

        <li><a onclick="get('battery')">battery</a></li>

        <li><a onclick="get('system')">system</a></li>

        <li><a onclick="get('settings')">settings</a></li>
    </ul>


    <!--Images-->
    <div id="images">
        <img id="circle" src="img/circle360.bmp">
        <img id="compNeedle" style="transform: rotate(0deg)" src="img/compNeedle.bmp" width="100" height="100">
        <img id="levelbar" src="img/levelbar.png" width="50" height="500">
        <img id="progressbar" src="img/progressBar.png" width="10" height="50">
        <img id="heightNeedle" src="img/compNeedle100.png" width="50" height="50">

    </div>

    <table id="output">
        <tr>
        </tr>
    </table>

    <table id="vals">
        <tr>
            <th>
                vertical angle:
            </th>
            <th>
                horizontal angle:
            </th>
            <th>
                longitude:
            </th>
            <th>
                lattitude:
            </th>
            <th>
                altitude:
            </th>
        </tr>
        <tr>
            <th>
                1
            </th>
            <th>
                2
            </th>
            <th id="long">
                3
            </th>
            <th id="latt">
                4
            </th>
            <th id="alt">
                5
            </th>
        </tr>
        <tr>
            <th>
                Battery 1 voltage:
            </th>
            <th>
                cell1:
            </th>
            <th>
                cell2:
            </th>

            <th>
                cell3:
            </th>

            <th>
                cell4:
            </th>
        </tr>
        <tr>
            <th>
                1
            </th>
            <th>
                2
            </th>
            <th>
                4
            </th>
            <th>
                5
            </th>
            <th>
                6
            </th>
        </tr>
        <tr>
            <th>
                Battery 2 voltage:
            </th>
            <th>
                cell1:
            </th>
            <th>
                cell2:
            </th>

            <th>
                cell3:
            </th>

            <th>
                cell4:
            </th>
        </tr>
        <tr>
            <th>
                1
            </th>
            <th>
                2
            </th>
            <th>
                4
            </th>
            <th>
                5
            </th>
            <th>
                6
            </th>
        </tr>
    </table>

    <table id="systems">
        <tr>
            <th>
                <p>ADC</p>
            </th>
            <th>
                <p>Magnetsens</p>
            </th>
            <th>
                <p>WIFI</p>
            </th>
            <th>
                <p>Bluetooth</p>
            </th>
            <th>
                <p>I2C</p>
            </th>
            <th>
                <p>SPI</p>
            </th>
            <th>
                <p>Drohne</p>
            </th>
        </tr>
    </table>


</body>

</html>